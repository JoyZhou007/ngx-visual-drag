!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("ng-zorro-antd/message"),require("rxjs"),require("@angular/common"),require("ng-zorro-antd/button"),require("ng-zorro-antd/input"),require("@angular/forms"),require("ng-zorro-antd/layout"),require("ng-zorro-antd/tabs"),require("ng-zorro-antd/select"),require("@angular/platform-browser/animations")):"function"==typeof define&&define.amd?define("ngx-visual-drag",["exports","@angular/core","ng-zorro-antd/message","rxjs","@angular/common","ng-zorro-antd/button","ng-zorro-antd/input","@angular/forms","ng-zorro-antd/layout","ng-zorro-antd/tabs","ng-zorro-antd/select","@angular/platform-browser/animations"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ngx-visual-drag"]={},t.ng.core,t.i1,t.rxjs,t.ng.common,t.button,t.input,t.ng.forms,t.layout,t.tabs,t.select,t.ng.platformBrowser.animations)}(this,(function(t,e,n,o,i,a,r,p,s,c,l,m){"use strict";var u=function(){};u.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new u},token:u,providedIn:"root"}),u.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],u.ctorParameters=function(){return[]};var h=0;function d(){return h++}function g(t){if("object"==typeof t){var e=Array.isArray(t)?[]:{};for(var n in t)"object"==typeof t[n]?e[n]=g(t[n]):e[n]=t[n];return e}return t}function f(t,e,n){var o=t[e];t[e]=t[n],t[n]=o}var y=function(){function t(t){var e=this;this.message=t,this.componentData=[],this.canvasStyleData={width:1200,height:740},this.$shapeStyle=new o.Subject,this.contextmenu={show:!1,top:0,left:0},this.snapshotData=[],this.snapshotIndex=-1,this.notification=new o.Subject,this.$storageData=new o.Subject,this.initData(),this.$shapeStyle.subscribe((function(t){t.top&&(e.curComponent.style.top=t.top),t.left&&(e.curComponent.style.left=t.left),t.width&&(e.curComponent.style.width=t.width),t.height&&(e.curComponent.style.height=t.height),t.rotate&&(e.curComponent.style.rotate=t.rotate)}))}return t.prototype.initData=function(){},t.prototype.deleteCurComponent=function(){this.componentData.splice(this.curComponentIndex,1)},t.prototype.hideContextMenu=function(){this.contextmenu={show:!1,top:0,left:0}},t.prototype.upComponent=function(){this.curComponentIndex<this.componentData.length-1?f(this.componentData,this.curComponentIndex,this.curComponentIndex+1):this.message.warning("已经到顶了")},t.prototype.downComponent=function(){this.curComponentIndex>0?f(this.componentData,this.curComponentIndex,this.curComponentIndex-1):this.message.warning("已经到底了")},t.prototype.topComponent=function(){this.curComponentIndex<this.componentData.length-1?f(this.componentData,this.curComponentIndex,this.componentData.length-1):this.message.warning("已经到顶了")},t.prototype.bottomComponent=function(){this.curComponentIndex>0?f(this.componentData,this.curComponentIndex,0):this.message.warning("已经到底了")},t.prototype.recordSnapshot=function(){this.snapshotData[++this.snapshotIndex]=g(this.componentData),this.snapshotIndex<this.snapshotData.length-1&&(this.snapshotData=this.snapshotData.slice(0,this.snapshotIndex+1))},t.prototype.undo=function(){this.snapshotIndex>=0&&(this.snapshotIndex--,this.componentData=g(this.snapshotData[this.snapshotIndex])||[])},t.prototype.redo=function(){this.snapshotIndex<this.snapshotData.length-1&&(this.snapshotIndex++,this.componentData=g(this.snapshotData[this.snapshotIndex])||[])},t.prototype.setShapePosStyle=function(t){var e=t.key,n=t.value;this.curComponent.style[e]=n},t.prototype.copy=function(){this.copyData={data:g(this.curComponent),index:this.curComponentIndex}},t.prototype.paste=function(t){if(this.copyData){var e=this.copyData.data;t?(e.style.top=this.contextmenu.top,e.style.left=this.contextmenu.left):(e.style.top+=10,e.style.left+=10),e.id=d(),this.addComponent(e),this.recordSnapshot(),this.copyData=null}else this.message.warning("请选择组件")},t.prototype.addComponent=function(t,e){void 0!==e?this.componentData.splice(e,0,t):this.componentData.push(t)},t.prototype.cut=function(){this.curComponent?(this.copyData&&(this.addComponent(this.copyData.data,this.copyData.index),this.curComponentIndex>=this.copyData.index&&this.curComponentIndex++),this.copy(),this.deleteCurComponent()):this.message.warning("请选择组件")},t.prototype.clearCanvas=function(){this.componentData=[]},t.prototype.restore=function(t){t?(this.componentData=this.resetID(t.canvasData),this.canvasStyleData=t.canvasStyle):(localStorage.getItem("canvasData")&&(this.componentData=this.resetID(JSON.parse(localStorage.getItem("canvasData")))),localStorage.getItem("canvasStyle")&&(this.canvasStyleData=JSON.parse(localStorage.getItem("canvasStyle"))))},t.prototype.save=function(){localStorage.setItem("canvasData",JSON.stringify(this.componentData)),localStorage.setItem("canvasStyle",JSON.stringify(this.canvasStyleData)),this.message.success("保存成功"),this.$storageData.next({canvasData:this.componentData,canvasStyle:this.canvasStyleData})},t.prototype.resetID=function(t){return t.forEach((function(t){t.id=d()})),t},t.prototype.setEditMode=function(t){this.editMode=t},t}();y.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new y(e.ɵɵinject(n.NzMessageService))},token:y,providedIn:"root"}),y.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],y.ctorParameters=function(){return[{type:n.NzMessageService}]};var v=function(){function t(t){this.componentDataService=t,this.onDataSave=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;this.componentDataService.$storageData.subscribe((function(e){t.onDataSave.emit(e)}))},t}();v.decorators=[{type:e.Component,args:[{selector:"lib-ngx-visual-drag",template:' <lib-home [data]="data"></lib-home> ',encapsulation:e.ViewEncapsulation.None,styles:['@import "~ng-zorro-antd/ng-zorro-antd.min.css";.mt-10{margin-top:10px!important}.mt-11{margin-top:11px!important}.mt-12{margin-top:12px!important}.mt-13{margin-top:13px!important}.mt-14{margin-top:14px!important}.mt-15{margin-top:15px!important}.mt-16{margin-top:16px!important}.mt-17{margin-top:17px!important}.mt-18{margin-top:18px!important}.mt-19{margin-top:19px!important}.mt-20{margin-top:20px!important}.mt-21{margin-top:21px!important}.mt-22{margin-top:22px!important}.mt-23{margin-top:23px!important}.mt-24{margin-top:24px!important}.mt-25{margin-top:25px!important}.mt-26{margin-top:26px!important}.mt-27{margin-top:27px!important}.mt-28{margin-top:28px!important}.mt-29{margin-top:29px!important}.mr-10{margin-right:10px!important}.mr-11{margin-right:11px!important}.mr-12{margin-right:12px!important}.mr-13{margin-right:13px!important}.mr-14{margin-right:14px!important}.mr-15{margin-right:15px!important}.mr-16{margin-right:16px!important}.mr-17{margin-right:17px!important}.mr-18{margin-right:18px!important}.mr-19{margin-right:19px!important}.mr-20{margin-right:20px!important}.mr-21{margin-right:21px!important}.mr-22{margin-right:22px!important}.mr-23{margin-right:23px!important}.mr-24{margin-right:24px!important}.mr-25{margin-right:25px!important}.mr-26{margin-right:26px!important}.mr-27{margin-right:27px!important}.mr-28{margin-right:28px!important}.mr-29{margin-right:29px!important}.mb-10{margin-bottom:10px!important}.mb-11{margin-bottom:11px!important}.mb-12{margin-bottom:12px!important}.mb-13{margin-bottom:13px!important}.mb-14{margin-bottom:14px!important}.mb-15{margin-bottom:15px!important}.mb-16{margin-bottom:16px!important}.mb-17{margin-bottom:17px!important}.mb-18{margin-bottom:18px!important}.mb-19{margin-bottom:19px!important}.mb-20{margin-bottom:20px!important}.mb-21{margin-bottom:21px!important}.mb-22{margin-bottom:22px!important}.mb-23{margin-bottom:23px!important}.mb-24{margin-bottom:24px!important}.mb-25{margin-bottom:25px!important}.mb-26{margin-bottom:26px!important}.mb-27{margin-bottom:27px!important}.mb-28{margin-bottom:28px!important}.mb-29{margin-bottom:29px!important}.ml-10{margin-left:10px!important}.ml-11{margin-left:11px!important}.ml-12{margin-left:12px!important}.ml-13{margin-left:13px!important}.ml-14{margin-left:14px!important}.ml-15{margin-left:15px!important}.ml-16{margin-left:16px!important}.ml-17{margin-left:17px!important}.ml-18{margin-left:18px!important}.ml-19{margin-left:19px!important}.ml-20{margin-left:20px!important}.ml-21{margin-left:21px!important}.ml-22{margin-left:22px!important}.ml-23{margin-left:23px!important}.ml-24{margin-left:24px!important}.ml-25{margin-left:25px!important}.ml-26{margin-left:26px!important}.ml-27{margin-left:27px!important}.ml-28{margin-left:28px!important}.ml-29{margin-left:29px!important}.absoulte{position:absolute}']}]}],v.ctorParameters=function(){return[{type:y}]},v.propDecorators={data:[{type:e.Input}],onDataSave:[{type:e.Output}]};var x={rotate:"",opacity:1},b=[{component:"v-text",label:"文字",propValue:"文字",icon:"el-icon-edit",animations:[],events:{},style:{width:200,height:33,fontSize:14,fontWeight:500,lineHeight:"",letterSpacing:0,textAlign:"",color:""}},{component:"v-button",label:"按钮",propValue:"按钮",icon:"el-icon-thumb",animations:[],events:{},style:{width:100,height:34,borderWidth:"",borderColor:"",borderRadius:"",fontSize:14,fontWeight:500,lineHeight:"",letterSpacing:0,textAlign:"",color:"",backgroundColor:""}},{component:"Picture",label:"图片",icon:"el-icon-picture",propValue:"./../../assets/title.jpg",animations:[],events:{},style:{width:300,height:200,borderRadius:""}}];b.forEach((function(t){t.style=Object.assign(Object.assign({},t.style),x)}));var S=function(){function t(t){this.componentDataService=t}return t.prototype.ngOnInit=function(){this.componentDataService.restore(this.data)},t.prototype.handleDrop=function(t){t.preventDefault(),t.stopPropagation();var e=g(b[t.dataTransfer.getData("index")]);e.style.top=t.offsetY,e.style.left=t.offsetX,e.id=d(),this.componentDataService.componentData.push(e),this.componentDataService.recordSnapshot()},t.prototype.handleDragOver=function(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},t.prototype.deselectCurComponent=function(){this.componentDataService.curComponent=null,this.componentDataService.curComponentIndex=null,this.componentDataService.hideContextMenu()},t}();S.decorators=[{type:e.Component,args:[{selector:"lib-home",template:'<div class="home">\n    <toolbar></toolbar>\n\n    <main>\n        \x3c!-- 左侧组件列表 --\x3e\n        <section class="left">\n            <component-list></component-list>\n        </section>\n        \x3c!-- 中间画布 --\x3e\n        <section class="center">\n            <div class="content" (drop)="handleDrop($event)" (dragover)="handleDragOver($event)"\n                (click)="deselectCurComponent()">\n                <editor></editor>\n            </div>\n        </section>\n        \x3c!-- 右侧属性列表 --\x3e\n        <section class="right">\n            \x3c!-- <el-tabs v-model="activeName">\n                <el-tab-pane label="属性" name="attr">\n                    <AttrList v-if="curComponent" />\n                    <p v-else class="placeholder">请选择组件</p>\n                </el-tab-pane>\n                <el-tab-pane label="动画" name="animation">\n                    <AnimationList v-if="curComponent" />\n                    <p v-else class="placeholder">请选择组件</p>\n                </el-tab-pane>\n                <el-tab-pane label="事件" name="events">\n                    <EventList v-if="curComponent" />\n                    <p v-else class="placeholder">请选择组件</p>\n                </el-tab-pane>\n            </el-tabs> --\x3e\n            <nz-tabset class="tabset">\n                <nz-tab nzTitle="属性">\n                    <Attr-list *ngIf="!!componentDataService.curComponent"></Attr-list>\n                </nz-tab>\n                <nz-tab nzTitle="Tab 2">\n                    Content of Tab Pane 2\n                </nz-tab>\n                <nz-tab nzTitle="Tab 3">\n                    Content of Tab Pane 3\n                </nz-tab>\n            </nz-tabset>\n        </section>\n    </main>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".home{background:#fff;height:100vh}.home main{height:calc(100% - 64px);position:relative}.home main .left{left:0;padding-top:10px;width:200px}.home main .left,.home main .right{height:100%;position:absolute;top:0}.home main .right{padding:0 15px;right:0;width:262px}.home main .right .tabset{height:100%}.home main .center,.home main .right .tabset .ant-tabs-content-holder{height:100%;overflow:auto}.home main .center{background:#f5f5f5;margin-left:200px;margin-right:262px;padding:20px}.home main .center .content{align-items:center;display:flex;height:100%;justify-content:center;overflow:auto}.home .placeholder{color:#333;text-align:center}"]}]}],S.ctorParameters=function(){return[{type:y}]},S.propDecorators={data:[{type:e.Input}]};var w=function(){function t(t,e){this.componentDataService=t,this.message=e,this.isShowPreview=!1}return t.prototype.ngOnInit=function(){},t.prototype.redo=function(){this.componentDataService.redo()},t.prototype.undo=function(){this.componentDataService.undo()},t.prototype.save=function(){this.componentDataService.save()},t.prototype.clearCanvas=function(){this.componentDataService.clearCanvas()},t.prototype.preview=function(){this.isShowPreview=!0,this.componentDataService.setEditMode("read")},t.prototype.closePreview=function(){this.isShowPreview=!1},t}();w.decorators=[{type:e.Component,args:[{selector:"toolbar",template:'<div>\n    <div class="toolbar">\n        <button nz-button (click)="undo()" class="mr-20  ml-20">撤消</button>\n        <button nz-button (click)="redo()" class="mr-20">重做</button>\n        <label for="input" class="insert">插入图片</label>\n        <input type="file" id="input" hidden />\n        <button nz-button style="margin-left: 10px;" class="mr-20" (click)="preview()">预览</button>\n        <button nz-button class="mr-20" (click)="save()">保存</button>\n        <button nz-button (click)="clearCanvas()">清空画布</button>\n        <div class="canvas-config">\n            <span>画布大小</span>\n            <input nz-input [(ngModel)]="componentDataService.canvasStyleData.width">\n            <span>*</span>\n            <input nz-input [(ngModel)]="componentDataService.canvasStyleData.height">\n        </div>\n    </div>\n\n    \x3c!-- 预览 --\x3e\n    \x3c!-- <Preview v-model="isShowPreview" @change="handlePreviewChange" /> --\x3e\n    <Preview [isShowPreview]="isShowPreview" (OutClose)="closePreview()"></Preview>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".toolbar{background:#fff;border-bottom:1px solid #ddd;height:64px;line-height:64px}.toolbar .canvas-config{color:#606266;display:inline-block;font-size:14px;margin-left:10px}.toolbar .canvas-config input{border:1px solid #ddd;color:#606266;margin-left:10px;outline:none;padding:0 5px;width:50px}.toolbar .canvas-config span{margin-left:10px}.toolbar .insert{-webkit-appearance:none;background:#fff;border:1px solid #dcdfe6;border-radius:3px;box-sizing:border-box;color:#606266;cursor:pointer;display:inline-block;font-size:12px;font-weight:500;line-height:1;margin:0 0 0 10px;outline:0;padding:9px 15px;text-align:center;transition:.1s;white-space:nowrap}.toolbar .insert:active{border-color:#3a8ee6;color:#3a8ee6;outline:0}.toolbar .insert:hover{background-color:#ecf5ff;color:#3a8ee6}"]}]}],w.ctorParameters=function(){return[{type:y},{type:n.NzMessageService}]};Object.create;function D(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,a=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)r.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return r}function C(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(D(arguments[e]));return t}Object.create;var M=[a.NzButtonModule,r.NzInputModule,n.NzMessageModule,s.NzLayoutModule,c.NzTabsModule,l.NzSelectModule],z=[i.CommonModule,p.FormsModule],I=function(){};I.decorators=[{type:e.NgModule,args:[{declarations:[],imports:C(z,M),exports:C([z],M)}]}];var k=function(){function t(){this.componentList=b}return t.prototype.ngOnInit=function(){},t.prototype.handleDragStart=function(t){t.dataTransfer.setData("index",t.target.dataset.index)},t}();function N(t,e){void 0===e&&(e=[]);var n=["fontSize","width","height","top","left","borderWidth","borderRadius"],o={};return Object.keys(t).forEach((function(i){e.includes(i)||("rotate"!=i?(o[i]=t[i],n.includes(i)&&(o[i]+="px")):o.transform=i+"("+t[i]+"deg)")})),o}k.decorators=[{type:e.Component,args:[{selector:"component-list",template:'<div class="component-list">\n    <div *ngFor="let item of componentList; index as i" class="list" draggable="true"\n        (dragstart)="handleDragStart($event)" [attr.data-index]="i">\n        <i class="{{item.icon}}"></i>\n        <span>{{ item.label }}</span>\n    </div>\n</div>',styles:[".component-list{display:flex;flex-wrap:wrap;justify-content:space-between;padding:10px}.component-list .list{border:1px solid #ddd;color:#333;cursor:grab;margin-bottom:10px;padding:2px 5px;text-align:center;width:45%}.component-list .list:active{cursor:grabbing}"]}]}],k.ctorParameters=function(){return[]};var P=function(){function t(t){this.componentDataService=t,this.isEdit=!1}return t.prototype.ngOnInit=function(){},t.prototype.handleContextMenu=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.target,n=t.offsetY,o=t.offsetX;!e.className.includes("editor");)o+=e.offsetLeft,n+=e.offsetTop,e=e.parentNode;this.componentDataService.contextmenu={show:!0,top:n,left:o}},t.prototype.getComponentStyle=function(t){return N(t,["top","left","width","height","rotate"])},t}();function O(t){return t*Math.PI/180}function j(t,e,n){return{x:(t.x-e.x)*Math.cos(O(n))-(t.y-e.y)*Math.sin(O(n))+e.x,y:(t.x-e.x)*Math.sin(O(n))+(t.y-e.y)*Math.cos(O(n))+e.y}}function E(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}}function V(t){return Math.abs(Math.sin(O(t)))}function L(t){return Math.abs(Math.cos(O(t)))}P.decorators=[{type:e.Component,args:[{selector:"editor",template:'<div class="editor" id="editor" [class.edit]="isEdit" [style.width.px]="componentDataService.canvasStyleData.width"\n    [style.height.px]="componentDataService.canvasStyleData.height" (contextmenu)="handleContextMenu($event)">\n    \x3c!--页面组件列表展示--\x3e\n    <shape *ngFor="let item of componentDataService.componentData; index as i" [defaultStyle]="item.style"\n        [active]="item.id === componentDataService?.curComponent?.id" [element]="item" [index]="i">\n        <ng-container [ngSwitch]="item.component">\n            <ng-container *ngSwitchCase="\'v-button\'">\n                <v-button class="component" [propValue]="item.propValue" [vStyle]="getComponentStyle(item.style)">\n                </v-button>\n            </ng-container>\n            <ng-container *ngSwitchCase="\'v-text\'">\n\n            </ng-container>\n            <ng-container *ngSwitchDefault>\n\n            </ng-container>\n        </ng-container>\n        \x3c!-- <component v-if="item.component != \'v-text\'" class="component" :is="item.component"\n            :style="getComponentStyle(item.style)" :propValue="item.propValue" />\n\n        <component v-else class="component" :is="item.component" :style="getComponentStyle(item.style)"\n            :propValue="item.propValue" @input="handleInput" :element="item" /> --\x3e\n    </shape>\n    \x3c!-- 右击菜单 --\x3e\n    <context-menu></context-menu>\n    \x3c!-- 标线 --\x3e\n    <Markline></Markline>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".editor{background:#fff;flex-shrink:0;position:relative}.edit .component{height:100%;outline:none;width:100%}"]}]}],P.ctorParameters=function(){return[{type:y}]};var T={lt:function(t,e,n){var o=n.symmetricPoint,i=E(e,o),a=j(e,i,-t.rotate),r=j(o,i,-t.rotate),p=r.x-a.x,s=r.y-a.y;p>0&&s>0&&(t.width=Math.round(p),t.height=Math.round(s),t.left=Math.round(a.x),t.top=Math.round(a.y))},t:function(t,e,n){var o=n.symmetricPoint,i=n.curPoint,a=j(e,i,-t.rotate),r=j({x:i.x,y:a.y},i,t.rotate),p=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2));if(p>0){var s={x:r.x-(r.x-o.x)/2,y:r.y+(o.y-r.y)/2};t.height=Math.round(p),t.top=Math.round(s.y-p/2),t.left=Math.round(s.x-t.width/2)}},rt:function(t,e,n){var o=n.symmetricPoint,i=E(e,o),a=j(e,i,-t.rotate),r=j(o,i,-t.rotate),p=a.x-r.x,s=r.y-a.y;p>0&&s>0&&(t.width=Math.round(p),t.height=Math.round(s),t.left=Math.round(r.x),t.top=Math.round(a.y))},r:function(t,e,n){var o=n.symmetricPoint,i=n.curPoint,a=j(e,i,-t.rotate),r=j({x:a.x,y:i.y},i,t.rotate),p=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2));if(p>0){var s={x:r.x-(r.x-o.x)/2,y:r.y+(o.y-r.y)/2};t.width=Math.round(p),t.top=Math.round(s.y-t.height/2),t.left=Math.round(s.x-p/2)}},rb:function(t,e,n){var o=n.symmetricPoint,i=E(e,o),a=j(o,i,-t.rotate),r=j(e,i,-t.rotate),p=r.x-a.x,s=r.y-a.y;p>0&&s>0&&(t.width=Math.round(p),t.height=Math.round(s),t.left=Math.round(a.x),t.top=Math.round(a.y))},b:function(t,e,n){var o=n.symmetricPoint,i=n.curPoint,a=j(e,i,-t.rotate),r=j({x:i.x,y:a.y},i,t.rotate),p=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2));if(p>0){var s={x:r.x-(r.x-o.x)/2,y:r.y+(o.y-r.y)/2};t.height=Math.round(p),t.top=Math.round(s.y-p/2),t.left=Math.round(s.x-t.width/2)}},lb:function(t,e,n){var o=n.symmetricPoint,i=E(e,o),a=j(o,i,-t.rotate),r=j(e,i,-t.rotate),p=a.x-r.x,s=r.y-a.y;p>0&&s>0&&(t.width=Math.round(p),t.height=Math.round(s),t.left=Math.round(r.x),t.top=Math.round(a.y))},l:function(t,e,n){var o=n.symmetricPoint,i=n.curPoint,a=j(e,i,-t.rotate),r=j({x:a.x,y:i.y},i,t.rotate),p=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2));if(p>0){var s={x:r.x-(r.x-o.x)/2,y:r.y+(o.y-r.y)/2};t.width=Math.round(p),t.top=Math.round(s.y-t.height/2),t.left=Math.round(s.x-p/2)}}};var A=function(){function t(t){this.componentDataService=t,this.active=!1,this.cursors={},this.pointList=["lt","t","rt","r","rb","b","lb","l"],this.initialAngle={lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},this.angleToCursor=[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}]}return t.prototype.ngOnInit=function(){},t.prototype.getShapeStyle=function(t){var e=Object.assign({},t);return e.width&&(e.width+="px"),e.height&&(e.height+="px"),e.top&&(e.top+="px"),e.left&&(e.left+="px"),e.rotate&&(e.transform="rotate("+e.rotate+"deg)"),e},t.prototype.handleMouseDownOnShape=function(t){var e=this;"v-text"!=this.element.component&&t.preventDefault(),t.stopPropagation(),this.componentDataService.curComponent=this.element,this.componentDataService.curComponentIndex=this.index,this.cursors=this.getCursor();var n=Object.assign({},this.defaultStyle),o=t.clientY,i=t.clientX,a=Number(n.top),r=Number(n.left),p=!1,s=function(t){p=!0;var s=t.clientX,c=t.clientY;n.top=c-o+a,n.left=s-i+r,e.componentDataService.$shapeStyle.next(n),e.componentDataService.notification.next({event:"move",value:[c-o>0,s-i>0]})},c=function(){p&&e.componentDataService.recordSnapshot(),e.componentDataService.notification.next({event:"unmove"}),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",c)},t.prototype.selectCurComponent=function(t){t.stopPropagation(),t.preventDefault(),this.componentDataService.hideContextMenu()},t.prototype.handleRotate=function(){},t.prototype.handleMouseDownOnPoint=function(t,e){var n=this,o=window.event;o.stopPropagation(),o.preventDefault();var i=Object.assign({},this.defaultStyle),a={x:i.left+i.width/2,y:i.top+i.height/2},r=document.querySelector("#editor").getBoundingClientRect(),p={x:e.clientX-r.left,y:e.clientY-r.top},s={x:a.x-(p.x-a.x),y:a.y-(p.y-a.y)},c=!1,l=!0,m=function(e){if(l)l=!1;else{c=!0;var o={x:e.clientX-r.left,y:e.clientY-r.top};!function(t,e,n,o){T[t](e,n,o)}(t,i,o,{center:a,curPoint:p,symmetricPoint:s}),n.componentDataService.$shapeStyle.next(i)}},u=function(){document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",u),c&&n.componentDataService.recordSnapshot()};document.addEventListener("mousemove",m),document.addEventListener("mouseup",u)},t.prototype.getPointStyle=function(t){var e=this.defaultStyle,n=e.width,o=e.height,i=/t/.test(t),a=/b/.test(t),r=/l/.test(t),p=/r/.test(t),s=0,c=0;return 2===t.length?(s=r?0:n,c=i?0:o):((i||a)&&(s=n/2,c=i?0:o),(r||p)&&(s=r?0:n,c=Math.floor(o/2))),{marginLeft:"-4px",marginTop:"-4px",left:s+"px",top:c+"px",cursor:this.cursors[t]}},t.prototype.getCursor=function(){var t=this,e=t.angleToCursor,n=t.initialAngle,o=t.pointList,i=(this.componentDataService.curComponent.style.rotate+360)%360,a={},r=-1;return o.forEach((function(t){for(var o=(n[t]+i)%360,p=e.length;;){var s=e[r=(r+1)%p];if(o<23||o>=338)return void(a[t]="nw-resize");if(s.start<=o&&o<s.end)return void(a[t]=s.cursor+"-resize")}})),a},t}();A.decorators=[{type:e.Component,args:[{selector:"shape",template:'<div class="shape" [ngStyle]="getShapeStyle(defaultStyle)" [class.active]="active" (click)="selectCurComponent($event)"\n    (mousedown)="handleMouseDownOnShape($event)">\n    <i class="el-icon-refresh-right" *ngIf="active" (mousedown)="handleRotate()"></i>\n    <div class="shape-point" *ngFor="let item of (active? pointList : [])"\n        (mousedown)="handleMouseDownOnPoint(item, $event)" [ngStyle]="getPointStyle(item)">\n    </div>\n    <ng-content></ng-content>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".shape{position:absolute}.shape:hover{cursor:move}.active{-webkit-user-select:none;outline:1px solid #70c0ff;user-select:none}.shape-point{background:#fff;border:1px solid #59c7f9;border-radius:50%;height:8px;position:absolute;width:8px}.el-icon-refresh-right{color:#59c7f9;cursor:grab;font-size:18px;font-size:22px;font-weight:600;font-weight:400;left:50%;position:absolute;top:-30px;transform:translateX(-50%)}.el-icon-refresh-right:active{cursor:grabbing}"]}]}],A.ctorParameters=function(){return[{type:y}]},A.propDecorators={active:[{type:e.Input}],element:[{type:e.Input}],defaultStyle:[{type:e.Input}],index:[{type:e.Input}]};var q=function(){function t(){this.propValue="",this.vStyle={},this.absoulte=!1}return t.prototype.ngOnInit=function(){},t}();q.decorators=[{type:e.Component,args:[{selector:"v-button",template:'\n    <button class="v-button" [ngStyle]="vStyle" [class.absoulte]="absoulte">\n      {{ propValue }}\n    </button>\n  ',encapsulation:e.ViewEncapsulation.None,styles:[".v-button{-webkit-appearance:none;background:#fff;border:1px solid #dcdfe6;box-sizing:border-box;color:#606266;cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:100%;line-height:1;margin:0;outline:0;text-align:center;transition:.1s;white-space:nowrap;width:100%}.v-button:active{border-color:#3a8ee6;color:#3a8ee6;outline:0}.v-button:hover{background-color:#ecf5ff;color:#3a8ee6}"]}]}],q.ctorParameters=function(){return[]},q.propDecorators={propValue:[{type:e.Input}],vStyle:[{type:e.Input}],absoulte:[{type:e.Input}]};var $=function(){function t(t){this.componentDataService=t}return Object.defineProperty(t.prototype,"menuShow",{get:function(){return this.componentDataService.contextmenu.show},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"menuTop",{get:function(){return this.componentDataService.contextmenu.top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"menuLeft",{get:function(){return this.componentDataService.contextmenu.left},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.copy=function(){this.componentDataService.copy()},t.prototype.paste=function(){this.componentDataService.paste(!0)},t.prototype.cut=function(){this.componentDataService.cut()},t.prototype.deleteComponent=function(){this.componentDataService.deleteCurComponent(),this.componentDataService.recordSnapshot()},t.prototype.topComponent=function(){this.componentDataService.topComponent(),this.componentDataService.recordSnapshot()},t.prototype.bottomComponent=function(){this.componentDataService.bottomComponent(),this.componentDataService.recordSnapshot()},t.prototype.upComponent=function(){this.componentDataService.upComponent(),this.componentDataService.recordSnapshot()},t.prototype.downComponent=function(){this.componentDataService.downComponent(),this.componentDataService.recordSnapshot()},t}();$.decorators=[{type:e.Component,args:[{selector:"context-menu",template:'<div class="contextmenu" *ngIf="menuShow" [style.top.px]="menuTop" [style.left.px]="menuLeft">\n    <ul>\n        <ng-container *ngIf="componentDataService.curComponent; else pasteTmp">\n            <li (click)="copy()">复制</li>\n            <li (click)="paste()">粘贴</li>\n            <li (click)="cut()">剪切</li>\n            <li (click)="deleteComponent()">删除</li>\n            <li (click)="topComponent()">置顶</li>\n            <li (click)="bottomComponent()">置底</li>\n            <li (click)="upComponent()">上移</li>\n            <li (click)="downComponent()">下移</li>\n        </ng-container>\n        <ng-template #pasteTmp>\n            <li (click)="paste()">粘贴</li>\n        </ng-template>\n    </ul>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".contextmenu{position:absolute;z-index:1000}.contextmenu ul{background-color:#fff;border:1px solid #e4e7ed;border-radius:4px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1);box-sizing:border-box;margin:5px 0;padding:6px 0}.contextmenu ul li{box-sizing:border-box;color:#606266;cursor:pointer;font-size:14px;height:34px;line-height:34px;overflow:hidden;padding:0 20px;position:relative;text-overflow:ellipsis;white-space:nowrap}.contextmenu ul li:hover{background-color:#f5f7fa}"]}]}],$.ctorParameters=function(){return[{type:y}]};var R=function(){function t(t){this.componentDataService=t,this.lines=["xt","xc","xb","yl","yc","yr"],this.diff=3,this.lineStatus={xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}}return t.prototype.ngAfterContentInit=function(){},t.prototype.ngOnInit=function(){var t=this;this.componentDataService.notification.subscribe((function(e){"move"===e.event&&t.showLine(e.value[0],e.value[1]),"unmove"===e.event&&t.hideLine()}))},t.prototype.showLine=function(t,e){var n=this,o=Array.from(document.querySelectorAll(".line")),i=function(t){return o.find((function(e){return e.dataset.index===t}))},a=this.componentDataService.componentData,r=this.translateComponentStyle(this.componentDataService.curComponent.style),p=r.width/2,s=r.height/2;this.hideLine(),a.forEach((function(o){if(o!=n.componentDataService.curComponent){var a=n.translateComponentStyle(o.style),c=a.top,l=a.left,m=a.bottom,u=a.right,h=a.width/2,d=a.height/2,g={top:[{isNearly:n.isNearly(r.top,c),lineNode:i("xt"),line:"xt",dragShift:c,lineShift:c},{isNearly:n.isNearly(r.bottom,c),lineNode:i("xt"),line:"xt",dragShift:c-r.height,lineShift:c},{isNearly:n.isNearly(r.top+s,c+d),lineNode:i("xc"),line:"xc",dragShift:c+d-s,lineShift:c+d},{isNearly:n.isNearly(r.top,m),lineNode:i("xb"),line:"xb",dragShift:m,lineShift:m},{isNearly:n.isNearly(r.bottom,m),lineNode:i("xb"),line:"xb",dragShift:m-r.height,lineShift:m}],left:[{isNearly:n.isNearly(r.left,l),lineNode:i("yl"),line:"yl",dragShift:l,lineShift:l},{isNearly:n.isNearly(r.right,l),lineNode:i("yl"),line:"yl",dragShift:l-r.width,lineShift:l},{isNearly:n.isNearly(r.left+p,l+h),lineNode:i("yc"),line:"yc",dragShift:l+h-p,lineShift:l+h},{isNearly:n.isNearly(r.left,u),lineNode:i("yr"),line:"yr",dragShift:u,lineShift:u},{isNearly:n.isNearly(r.right,u),lineNode:i("yr"),line:"yr",dragShift:u-r.width,lineShift:u}]},f=[],y=n.componentDataService.curComponent.style.rotate;Object.keys(g).forEach((function(t){g[t].forEach((function(e){e.isNearly&&(n.componentDataService.setShapePosStyle({key:t,value:0!=y?n.translatecurComponentShift(t,e,r):e.dragShift}),e.lineNode.style[t]=e.lineShift+"px",f.push(e.line))}))})),f.length&&n.chooseTheTureLine(f,t,e)}}))},t.prototype.translateComponentStyle=function(t){if(0!=(t=Object.assign({},t)).rotate){var e=t.width*L(t.rotate)+t.height*V(t.rotate),n=(t.width-e)/2;t.left+=n,t.right=t.left+e;var o=t.height*L(t.rotate)+t.width*V(t.rotate),i=(o-t.height)/2;t.top-=i,t.bottom=t.top+o,t.width=e,t.height=o}else t.bottom=t.top+t.height,t.right=t.left+t.width;return t},t.prototype.hideLine=function(){var t=this;Object.keys(this.lineStatus).forEach((function(e){t.lineStatus[e]=!1}))},t.prototype.isNearly=function(t,e){return Math.abs(t-e)<=this.diff},t.prototype.translatecurComponentShift=function(t,e,n){var o=this.componentDataService.curComponent.style,i=o.width,a=o.height;return"top"==t?Math.round(e.dragShift-(a-n.height)/2):Math.round(e.dragShift-(i-n.width)/2)},t.prototype.chooseTheTureLine=function(t,e,n){n?t.includes("yr")?this.lineStatus.yr=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yl")&&(this.lineStatus.yl=!0):t.includes("yl")?this.lineStatus.yl=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yr")&&(this.lineStatus.yr=!0),e?t.includes("xb")?this.lineStatus.xb=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xt")&&(this.lineStatus.xt=!0):t.includes("xt")?this.lineStatus.xt=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xb")&&(this.lineStatus.xb=!0)},t}();R.decorators=[{type:e.Component,args:[{selector:"Markline",template:'<div class="mark-line">\n    <ng-container *ngFor="let line of lines">\n        <div class="line " #lines [ngClass]="{\n             \'xline\': line.includes(\'x\'),\n             \'yline\': line.includes(\'y\')\n        }" [attr.data-index]="line" [hidden]="!lineStatus[line]"></div>\n    </ng-container>\n\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".mark-line{height:100%}.line{background:#59c7f9;position:absolute;z-index:1000}.xline{height:1px;width:100%}.yline{height:100%;width:1px}"]}]}],R.ctorParameters=function(){return[{type:y}]},R.propDecorators={$refs:[{type:e.ViewChildren,args:["lines"]}]};var F=function(){function t(t){this.componentDataService=t,this.map={left:"x 坐标",top:"y 坐标",height:"高",width:"宽",color:"颜色",backgroundColor:"背景色",borderWidth:"边框宽度",borderColor:"边框颜色",borderRadius:"边框半径",fontSize:"字体大小",fontWeight:"字体粗细",lineHeight:"行高",letterSpacing:"字间距",textAlign:"对齐方式",opacity:"透明度"},this.excludes=["Picture"],this.options=[{label:"左对齐",value:"left"},{label:"居中",value:"center"},{label:"右对齐",value:"right"}]}return Object.defineProperty(t.prototype,"styleKeys",{get:function(){return this.componentDataService.curComponent?Object.keys(this.componentDataService.curComponent.style).filter((function(t){return"rotate"!=t})):[]},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){},t}();F.decorators=[{type:e.Component,args:[{selector:"Attr-list",template:'<div class="attr-list">\n    <div nz-row *ngFor="let key of styleKeys" class="mb-10">\n        <div nz-col nzSpan="24" class="mb-10">{{map[key]}}</div>\n        <div nz-col nzSpan="24">\n            <div [ngSwitch]="key">\n                <div *ngSwitchCase="\'borderColor\'"><input type="color"\n                        [(ngModel)]="componentDataService.curComponent.style[key]"></div>\n                <div *ngSwitchCase="\'color\'"><input type="color"\n                        [(ngModel)]="componentDataService.curComponent.style[key]"></div>\n                <div *ngSwitchCase="\'backgroundColor\'"><input type="color"\n                        [(ngModel)]="componentDataService.curComponent.style[key]"></div>\n                <div *ngSwitchCase="\'textAlign\'">\n                    <nz-select [(ngModel)]="componentDataService.curComponent.style[key]" style="width: 100%;">\n                        <nz-option [nzValue]="item.value" [nzLabel]="item.label" *ngFor="let item of options">\n                        </nz-option>\n                    </nz-select>\n                </div>\n                <div *ngSwitchDefault>\n                    <input nz-input type="number" [(ngModel)]="componentDataService.curComponent.style[key]">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div nz-row\n        *ngIf="componentDataService.curComponent && !excludes.includes(componentDataService.curComponent.component)">\n        <div nz-col nzSpan="24" class="mb-10">内容</div>\n        <div nz-col nzSpan="24">\n            <textarea nz-input [(ngModel)]="componentDataService.curComponent.propValue"\n                [nzAutosize]="{ minRows: 2, maxRows: 6 }"></textarea>\n        </div>\n    </div>\n</div>',styles:[".attr-list{height:100%;overflow:auto;padding:0 20px 20px}"]}]}],F.ctorParameters=function(){return[{type:y}]};var X=function(){function t(t){this.componentDataService=t,this.isShowPreview=!1,this.OutClose=new e.EventEmitter}return t.prototype.ngOnInit=function(){},t.prototype.close=function(){this.OutClose.emit()},t}();X.decorators=[{type:e.Component,args:[{selector:"Preview",template:'<div class="bg" *ngIf="isShowPreview">\n    <button (click)="close()" class="close" nz-button>关闭</button>\n    <div class="canvas-container">\n        <div class="canvas"\n            [ngStyle]="{ width: componentDataService.canvasStyleData.width + \'px\', height: componentDataService.canvasStyleData.height + \'px\' }">\n\n            <Component-wrapper *ngFor="let item of componentDataService.componentData" [config]="item">\n            </Component-wrapper>\n        </div>\n    </div>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".bg{background:rgba(0,0,0,.5);height:100%;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:10}.bg,.bg .canvas-container{align-items:center;display:flex;justify-content:center;overflow:auto}.bg .canvas-container{height:calc(100% - 120px);width:calc(100% - 40px)}.bg .canvas-container .canvas{background:#fff;flex-shrink:0;position:relative}.bg .close{position:absolute;right:20px;top:20px}"]}]}],X.ctorParameters=function(){return[{type:y}]},X.propDecorators={isShowPreview:[{type:e.Input}],OutClose:[{type:e.Output}]};var W=function(){function t(t){this.componentFactoryResolver=t}return t.prototype.ngOnChanges=function(t){t.config&&t.config.currentValue},t.prototype.addComponent=function(){},t.prototype.ngOnInit=function(){},t.prototype.handleClick=function(){},t.prototype.getComponentStyle=function(t){return N(t)},t}();W.decorators=[{type:e.Component,args:[{selector:"Component-wrapper",template:'<div (click)="handleClick()" class="component">\n    \x3c!-- <component class="conponent" :is="config.component" :style="getStyle(config.style)" :propValue="config.propValue" /> --\x3e\n    <ng-container [ngSwitch]="config.component">\n        <ng-container *ngSwitchCase="\'v-button\'">\n            <v-button [propValue]="config.propValue" [absoulte]="true" [vStyle]="getComponentStyle(config.style)">\n            </v-button>\n        </ng-container>\n        <ng-container *ngSwitchDefault>output2</ng-container>\n    </ng-container>\n</div>',encapsulation:e.ViewEncapsulation.None,styles:[".conponent{position:absolute}"]}]}],W.ctorParameters=function(){return[{type:e.ComponentFactoryResolver}]},W.propDecorators={config:[{type:e.Input}],viewContainer:[{type:e.ViewChild,args:["viewContainer",{read:e.ViewContainerRef,static:!0}]}]};var Y=function(){};Y.decorators=[{type:e.NgModule,args:[{declarations:[v,S,w,k,P,A,q,$,R,F,X,W],imports:[m.BrowserAnimationsModule,I],exports:[v]}]}],t.NgxVisualDragComponent=v,t.NgxVisualDragModule=Y,t.NgxVisualDragService=u,t.ɵa=y,t.ɵb=S,t.ɵc=w,t.ɵd=k,t.ɵe=P,t.ɵf=A,t.ɵg=q,t.ɵh=$,t.ɵi=R,t.ɵj=F,t.ɵk=X,t.ɵl=W,t.ɵm=I,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-visual-drag.umd.min.js.map